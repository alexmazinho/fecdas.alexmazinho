{# src/Fecdas/PartesBundle/Resources/views/Page/rebut.html.twig #}
{% extends 'FecdasBundle::layout.html.twig' %}

{% form_theme form 'FecdasBundle:Includes:formtheming.html.twig' %}

{% block stylesheets %}
	
	<link href="{{ asset('css/jquery.datetimepicker.css') }}" type="text/css" rel="stylesheet" />
	
	{{ parent() }}
{% endblock %}

{% block title %}Aplicació gestió FECDAS. Gestió de rebut i ingressos{% endblock %}

{% block body %}
    <header>
        <h1><a href="{{ path('FecdasBundle_ingresos') }}">Llistat d'ingressos i rebuts</a> > Ingrés </h1>
    </header>
    
	{% include 'FecdasBundle:Includes:messages.html.twig' %}
	
	<form id="formrebut" action="{{ path('FecdasBundle_editarrebut') }}" method="post" {{ form_enctype(form) }}  class="appform">
		<div class="row">
			{{ form_widget(form.id) }}{{ form_widget(form.num) }}
			 <div class="col-md-5">
			 	<div class="form-group">
					<label>Club</label>
					<div id="formrebut-club"  class="">
						{{ form_widget(form.club, { 'attr': {'class': 'form-control form-control-left'} }) }}
					</div>{{ form_errors(form.club) }}
				</div>
			 </div>
			 <div class="col-md-2">
			 	<div class="form-group">
					{{ form_label(form.numrebut, 'Núm. rebut') }}
					<div id="formrebut-num"  class="">
						{{ form_widget(form.numrebut, { 'attr': {'class': 'form-control form-control-center'} }) }}
					</div>{{ form_errors(form.numrebut)  }}
				</div>
			 </div>
			 <div class="col-md-2">
				<div class="form-group">
					{{ form_label(form.import, 'Import') }}
					<div id="formrebut-totalsuma"  class="input-group ">
						{{ form_widget(form.import, { 'attr': {'class': 'form-control form-control-center'} }) }}
						<span class="input-group-addon"><i class="fa fa-euro"></i></span>
					</div>{{ form_errors(form.import)  }}
				</div>
			 </div>
			 <div class="col-md-3">
				<div class="form-group">
					{{ form_label(form.datapagament, 'Data de pagament') }}
					<div id="formproducte-databaixa" class="input-group">
		  				<span class="input-group-addon">Pagat</span>
						{{ form_widget(form.datapagament, { 'attr': {'class': 'form-control form-control-center formtime-calendar'} }) }}
						<span class="input-group-addon input-group-addon-icon open-calendar"><span class="fa fa-calendar fa-1x"></span></span>
					</div>{{ form_errors(form.datapagament)  }}
				</div>
			 </div>
			 <div class="col-md-2">
				<div class="form-group">
					{{ form_label(form.dadespagament, 'Dades pagament') }}
					<div id="formrebut-dadespagament">
						{{ form_widget(form.dadespagament, { 'attr': {'class': 'form-control form-control-left'} }) }}
					</div>{{ form_errors(form.dadespagament)  }}
				</div>
			 </div>
			 <div class="col-md-3">
				<div class="form-group">
					{{ form_label(form.tipuspagament, 'Tipus de pagament') }}
					<div id="formrebut-tipuspagament"  class="input-group ">
						<span class="input-group-addon"><i class="fa fa-university"></i></span>
						{{ form_widget(form.tipuspagament, { 'attr': {'class': 'form-control form-control-left'} }) }}
					</div>{{ form_errors(form.tipuspagament)  }}
				</div>
			 </div>

			 <!-- <div class="col-md-6">
			  	<div class="form-group">
			    	{# form_label(form.comanda, 'Comanda') #}
			    	<div class="label-actions accions-comanda">
					{# if rebut.comanda is null #}
						<i class="fa fa-search fa-1x grey"></i>
					{# else %}
						<a id="editar-comanda" class="link" href="{# path('FecdasBundle_editarcomanda', {'id': rebut.comanda.id }) #}"  title="Editar comanda" alt="Editar comanda">
							<i class="fa fa-search fa-1x blue"></i></a>
					{# endif %}
					</div>
			    	<div id="formrebut-comanda">
						{# form_widget(form.comanda, { 'attr': {'class': 'form-control form-control-left'} }) #}
					</div>
				</div>
			 </div> -->
			 <div class="col-md-7">
			 	<div class="form-group">
			 		{{ form_label(form.comentari, 'Comentari') }}
					<div id="formrebut-comentari"  class="">
					{{ form_widget(form.comentari, { 'attr': {'class': 'form-control'} }) }}
					</div>
				</div>{{ form_errors(form.comentari)  }}
			 </div> 
			 <div class="col-md-3">
				<button type="submit" id="formrebut-desar" class="btn btn-default btn-lg"><i class="fa fa-save"></i> Desar</button>
			 	<button type="button" id="formrebut-automatic" class="btn btn-default btn-lg"><i class="fa fa-save"></i> Automàtic</button>
			 </div>
			 <div class="col-md-9 informacio-resultat-ingres col-last-right">
				<div class="import-seleccionat-candidats">Import seleccionat: <span class="label label-success">0,00 €</span></div>
				<div class="romanent-rebut">Romanent saldo club: <span class="label label-success">0,00 €</span></div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<div id="llista-candidates">
					{% include "FecdasBundle:Facturacio:ingrescomandes.html.twig" %}
				</div>
			</div>
			
		</div>
		
		<div id="formrebut-rest" class="sr-only">{{ form_rest(form) }}</div>
		
		<div id="error" class="sms-notice" style="display:none"> </div>
		
    </form>

{% endblock %}

{% block javascripts %}

	{{ parent() }}

	<!-- Datetime plugin's. http://xdsoft.net/jqplugins/datetimepicker/ -->
	<script src="{{ asset('js/jquery.datetimepicker.js') }}" type="text/javascript"></script>

	<script type="text/javascript">

		var formatter = new Intl.NumberFormat('es-CA', {
			  style: 'currency',
			  currency: 'EUR',
			  minimumFractionDigits: 2,
		});
		$(document).ready(function(){
			setMenuActive("menu-admrebut");

			$("select#rebut_club").select2({
				minimumInputLength: 2,
				allowClear: true,
			});

			$("select#rebut_club").change( function() {
				location.reload();
			});

			$("input#rebut_import").change( function() {
				

				// Canviar el valor de l'import ingresat reinicia selecció i valors
				$('.import-seleccionat-candidats span').html('0,00');

				
				$('.romanent-rebut span').html( formatter.format($(this).val()) );
				
			});

			$(".candidata-action-select").not('selected').click( function(e) {
				e.preventDefault();

				$(this).parents('.data-detall').addClass('candidata-selected');
				$(this).addClass('selected');
				$(this).children('.fa').toggleClass('fa-shown').toggleClass('fa-hidden');
				/*$(this).children('fa-close').toggleClass('fa-shown');
				$(this).children('fa-check').toggleClass('fa-hidden');*/

				var totalSeleccionat = 0;
				var elems = $(".candidata-action-select.selected").length;
				console.log('-> '+elems);
				$('.candidata-action-select.selected').each( function(i) {
					totalSeleccionat += $(this).attr('data-total')*1;
					console.log('--> '+i);
					if (i >= elems - 1) {
						console.log('---> '+totalSeleccionat);

						$('.import-seleccionat-candidats span').html( formatter.format(totalSeleccionat) );
						
						$('.romanent-rebut span').html( formatter.format( ($("input#rebut_import").val()*1) - totalSeleccionat ) );
					}
				});
				
			});
			
			
			/*$("select#rebut_comanda").select2({
				minimumInputLength: 2,
				allowClear: true,
			});*/

			/*$("select#rebut_comanda").change( function() {
				var id = $(this).val();
				

				var url = "{# path('FecdasBundle_editarcomanda', {'id': '__COMANDA__' }) #}";
				url = url.replace("__COMANDA__", id);

				$('.accions-comanda').html("<a id='editar-comanda' class='link' href='"+url+"' title='Editar comanda' alt=Editar comanda'> \
											<i class='fa fa-search fa-1x blue'></i></a>");
			}); */
			
			var current = new Date();
			
			var mindate = new Date (current.getFullYear(), current.getMonth() - 2, current.getDay());
			var maxdate = new Date (current.getFullYear(), current.getMonth() + 1, current.getDay());

			initDateTimePicker ( 
				$( '#rebut_datapagament' ), 
				mindate, 
				current, 
				current, 
				'datapagament-picker', 
				false,
				''
			);

		});
		
	</script>


{% endblock %}

