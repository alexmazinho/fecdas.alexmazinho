{# src/Fecdas/FecdasBundle/Resources/views/Facturacio/apunts.html.twig #}
{% extends 'FecdasBundle::layout.html.twig' %}

{% block stylesheets %}
	<!-- Select2 styles -->
	<link href="{{ asset('css/select2.css') }}" type="text/css" rel="stylesheet" />
	<link href="{{ asset('css/jquery.datetimepicker.css') }}" type="text/css" rel="stylesheet" />
	
	{{ parent() }}
{% endblock %}

{% block title %}Aplicació gestió FECDAS. Apunts del club {% endblock %}

{% block body %}
	<header>
        <h1>Saldo actual del club {{ club.saldo|number_format(2, ',', '.') }}€</h1>
    </header>
	{% include 'FecdasBundle:Includes:messages.html.twig' %}
        
    <div id="apunts-main">
	    <div id="list-forms">
	    	<form id="form_apunts" action="{{ path('FecdasBundle_apunts') }}" method="GET" {{ form_enctype(form) }}  class="appform">
				<div class="row">
					{% if admin == true %}
						  <div class="col-md-4 col-xs-12">
						  	<div class="form-group">
						    	{{ form_label(form.clubs, 'Cercar', { 'label_attr': {'class': 'sr-only'} }) }}
								{{ form_widget(form.clubs, { 'attr': {'class': 'form-control'} }) }}
							</div>
						  </div>
					{% endif %}
					<div class="col-md-3 col-xs-4">
						<div class="form-group">
							<div class="input-group">
				  				<span class="input-group-addon">Des de</span>
								{{ form_widget(form.datadesde, { 'attr': {'class': 'form-control form-control-center formtime-calendar'} }) }}
								<span class="input-group-addon input-group-addon-icon open-calendar"><span class="fa fa-calendar fa-1x"></span></span>
							</div>
						</div>
					</div>
					<div class="col-md-3 col-xs-4">
						<div class="form-group">
							<div class="input-group">
				  				<span class="input-group-addon">Fins</span>
								{{ form_widget(form.datafins, { 'attr': {'class': 'form-control form-control-center formtime-calendar'} }) }}
								<span class="input-group-addon input-group-addon-icon open-calendar"><span class="fa fa-calendar fa-1x"></span></span>
							</div>
						</div>
					</div>
					<div class="{% if admin == true %}col-md-2{% else %}col-md-6{% endif %} col-last-right">
						<a id="consulta-apunts" class="btn btn-default btn-lg">consultar <i class="fa fa-search"></i></a>
				  	</div>
				</div>
		   	</form>
	    </div>
	    <div id="taula-apunts">{% include 'FecdasBundle:Facturacio:taulaapunts.html.twig' %}</div>
	</div>
{% endblock %}

{% block javascripts %}

	{{ parent() }}
	<!-- Datetime plugin's. http://xdsoft.net/jqplugins/datetimepicker/ -->
 	<script src="{{ asset('js/jquery.datetimepicker.js') }}" type="text/javascript"></script>

	<script type="text/javascript">


	reloadScroll = function() {
		if ( $('.table-scroll').hasScrollBar() == true ) {

			var totalWidth = $('.table-header').width();
			var barWidth = 15;
			
			$('.col-listheader.collistheader-noorder').not('#header-apunt-entrada').each( function() {
				var ratio = $(this).width( )/totalWidth;
				
				$(this).width( $(this).width( ) - ( ratio * barWidth) );
			});

			$('#header-apunt-entrada').width( $('#header-apunt-entrada').width( ) + barWidth );
			//$('.table-header').width( $('.table-header').width( ) - 15 );
		};
	}
	
	reloadApunts = function(url) {
		showElementMask($('#taula-apunts'), true);
		
		$.get(url, function(data) {
			hideMask();

			$('#taula-apunts').html(data);

			reloadScroll();
			
		}).fail( function(xhr, status, error) {
			hideMask();
		});
	};
	
	$(document).ready(function(){

		var current = new Date();
		var mindate = new Date (Math.max(current.getFullYear() - 2, 2016), 1, 1);
		
		initDateTimePicker ( 
			$( '#form_datadesde' ), 
			mindate, 
			current, 
			current, 
			'datadesde-picker', 
			false,
			''
		);
		initDateTimePicker ( 
			$( '#form_datafins' ), 
			mindate, 
			current, 
			current, 
			'datafins-picker', 
			false,
			''
		);

		$("#consulta-apunts").click(function(e) {
			e.preventDefault();

			var club = $( "#form_clubs" ).val();
			var datadesde = $( "#form_datadesde" ).val();
			var datafins = $( "#form_datafins" ).val();

			var url = $('#form_apunts').attr('action');
			url += "?club="+club+"&datadesde="+datadesde+"&datafins="+datafins;
			
			reloadApunts(url);
	    });

		$( "#taula-apunts" ).on( "click", ".pagination a", function( e ) {
			e.preventDefault();

			var url = $(this).attr('href');
			
			reloadApunts(url);
	    });
		
		
		reloadScroll();

		
		{% if admin == true  %}
			setMenuActive("menu-admapunts");

			$("select#form_clubs").select2({
				minimumInputLength: 2,
				allowClear: true,
				placeholder: 'Seleccionar Club'
			});
		{% else %}
			setMenuActive("menu-apunts");
		{% endif %}

	});
	
	</script>


{% endblock %}

