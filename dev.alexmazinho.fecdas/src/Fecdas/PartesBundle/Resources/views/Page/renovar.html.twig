{# src/Fecdas/PartesBundle/Resources/views/Page/parte.html.twig #}
{% extends 'FecdasPartesBundle::layout.html.twig' %}

{% block title %}Aplicació gestió FECDAS. Renovació de llistes d'assegurats {% endblock %}

{% block body %}
    <header>
        <h1>Renovació de llistes d'assegurats</h1>
    </header>
   
	<form id="formrenovar" action="{{ path('FecdasPartesBundle_renovar') }}" method="post" {{ form_enctype(form) }}  class="appform">
		{%  if form_errors(form) is not empty %}
			<div class="sms-notice">{{ form_errors(form)  }}</div>
		{% endif %}	

		<div class="form-row clearfix">
			<div id="formparte-any" class="form-left">
				<label class="formlabel-outside required">Any</label>
				{{ form_widget(form.any, { 'id': 'parte_any', 'attr': {'class': 'formfield-outside'} }) }}
			</div>
			<div id="formparte-club" class="form-left">
				{{ form_label(form.club, 'Club', { 'attr': {'class': 'formlabel-outside'} }) }}
				{{ form_widget(form.club, { 'id': 'parte_renovar_club', 'attr': {'class': 'formfield-outside'} }) }}
			</div>
			<div id="formparte-tipus" class="form-left" data-ajax-route="{{ path('FecdasPartesBundle_gettipuspartes') }}">
				{{ form_label(form.tipus, 'Tipus de llistat d\'assegurats', { 'attr': {'class': 'formlabel-outside'} }) }}
				{{ form_widget(form.tipus, { 'id': 'parte_renovar_tipus', 'attr': {'class': 'formfield-outside'} }) }}
			</div>
			<div class="form-right">
				<div class="formlabel-outside required">&nbsp;</div>			
				<input type="submit" alt="Renovar llista" title="Renovar llista" 
					 id="formrenovar-button-renovar" class="forminput-inside" value="Renovar" name="formrenovar-button-renovar"/>
			</div>	
        </div>
		{% if app.session.hasFlash('error-notice') %}
    	<div class="sms-notice">
        	{{ app.session.flash('error-notice') }}
    	</div>
		{% endif %}		
        
	{% if form.llicencies|length > 0 and form.llicencies|length == parte.numLlicencies %}
		<div id="list-header" class="clearfix">
			<div id="header-totals" class="col-listheader"> 
			Llicències vàlides des de <time datetime="{{ parte.dataalta|date('c') }}">{{ parte.dataalta|date('d/m/Y') }}</time>
  			fins a <time datetime="{{ parte.datacaducitat|date('c') }}">{{ parte.datacaducitat|date('d/m/Y') }}</time></div>
  			<div id="parte-preu" class="col-listheader">Total: <div id="parte-preu-valor"></div> €</div>
		</div>
		{% if avisos != "" %}
    	<div class="sms-notice"><b>Avisos</b> <br/><br/>{{ avisos|raw }}</div>
		{% endif %}
		
		<div id="list-header" class="clearfix">
		   	<div id="header-llicenciapersonalong" class="col-listheader">Llicències</div>
		   	<div id="header-llicenciacategoria" class="col-listheader">Categoria</div>
		   	<div id="header-llicenciaactivitatslong" class="col-listheader">Activitats</div>
		   	<div id="header-llicenciapreu" class="col-listheader">Preu</div>
   			<div id="header-llicenciaenviarllicencia" class="col-listheader"><img src="{{ asset('images/icon_sobre.png') }}" alt="Rebre llicència per correu" title="Rebre llicència per correu" width="30px"></div>
		   	<div id="header-llicenciaactions" class="col-listheader">Renovar?</div>
		</div>

		<ol id="list-data">
		{% for llicencia in form.llicencies %}
			<li class="data-detall {% if llicencia.renovar is not defined %} data-detall-fosc {% endif %}">
				<div class="llicencia-personalong">{{  parte.llicencies[loop.index0].persona.cognomsNom|cut(30, false, '...') }}</div>
				<div class="llicencia-categoria">{{  parte.llicencies[loop.index0].categoria.categoria }}</div>
				<div class="llicencia-activitatslong">{{ parte.llicencies[loop.index0].activitats }}</div>
				<div class="llicencia-preu">{{  parte.llicencies[loop.index0].categoria.preuany(parte.any)|number_format(2, ',') }}</div>
				<div class="llicencia-enviarllicencia">		
				{% if parte.llicencies[loop.index0].enviarllicencia == 1 %} Si 	{% else %} No {% endif %}
				</div>
				{% if llicencia.renovar is defined %}
				<div class="llicencia-actions">{{ form_widget(llicencia.renovar, {'attr': {'class': 'renovar-checkbox', 'preu' : parte.llicencies[loop.index0].categoria.preuany(parte.any)} }) }}</div>
				{% else %}
				<div class="llicencia-no">No</div>
				{% endif %}
  			</li>
	   	{% endfor %}
		</ol>
{% else %}
		<div class="sms-notice">No hi ha llicències en aquesta llistats d'assegurats</div>
{% endif %}
        <div id="formrenovar-rest" style="display:none">
			<div class="formparte-id">{{ form_widget(form.id) }}</div>
			<div class="formparte-id">{{ form_widget(form.cloneid) }}</div>
        	{{ form_rest(form) }}</div>
    </form>
     
{% endblock %}

{% block javascripts %}

{{ parent() }}

<script type="text/javascript">

$(document).ready(function(){
	setMenuActive("menu-partes");
	
	validarRenovarNoBuida();

	calcularPreuRenovar();
});

</script>

{% endblock %}

