{# src/Fecdas/PartesBundle/Resources/views/Page/index.html.twig #}
{% extends 'FecdasPartesBundle::layout.html.twig' %}

{% block javascriptshead %}
 	{{ parent() }}
 	<script src="{{ asset('js/jquery.ui.datepicker-ca.js') }}" type="text/javascript"></script>
 	<script src="{{ asset('js/utils/purl.js') }}" type="text/javascript"></script>
    {{ form_javascript(form) }}
{% endblock %}

{% block title %}Aplicació gestió FECDAS. Llista de comunicacions del club{% endblock %}

{% block body %}
	<header>
        <h1>Llistes de comunicacions</h1>
    </header>
    {% for flashMessage in app.session.flashbag.get('error-notice') %}
    <div class="sms-notice">
		{{ flashMessage }}
  	</div>	
	{% endfor %}
        
    <div id="partes-main">
	    <div id="list-forms">
	    	<form id="form_partes" action="{{ path('FecdasPartesBundle_partes') }}" method="POST" {{ form_enctype(form) }}  class="appform">
    			<div id="formpartes-desde" class="form-col column-left form-left">
	    			{{ form_label(form.desde, 'Dades des de', { 'label_attr': {'class': 'formlabel-outside'} }) }}
					{{ form_widget(form.desde, { 'attr': {'class': 'formfield-outside formdate-calendar'} }) }}
				</div> 
				<div id="formpartes-fins" class="form-col column-left form-left">
	    			{{ form_label(form.fins, 'fins', { 'label_attr': {'class': 'formlabel-outside'} }) }}
					{{ form_widget(form.fins, { 'attr': {'class': 'formfield-outside formdate-calendar'} }) }}
				</div> 
				<div id="formpartes-tipus" class="form-col column-left form-left">
					{{ form_label(form.tipus, 'Tipus de llistat d\'assegurats', { 'label_attr': {'class': 'formlabel-outside'} }) }}
					{{ form_widget(form.tipus, { 'attr': {'class': 'formfield-outside'} }) }}
				</div>
				<div id="formpartes-club" class="form-col column-center"><p class="titol-club-nom">{{ club.nom }}</p></div>
				<div id="formpartes-submit" class="form-col column-right form-right">	
					<div class="formlabel-outside">&nbsp;</div>
					<input id="form_nouparte" type="submit" class="forminput-inside" value="Nou comunicat" name="formpartes-button-new"/>
				</div> 
		   	</form>
	    </div>
	    <div class="sms-header-info clearfix">{{ club.infoLlistat }}</div>
	    <div class="table-header">
			<div id="summary-header">
				<div id="partes-totals" class="col-listheader">Total: {{ partes.getTotalItemCount|number_format(0, ',', '.') }} llistes ({{ stat['ltotal']|number_format(0, ',', '.') }} llicències)<br/> 
				<span>Vigents: {{ stat['vigents']|number_format(0, ',', '.') }} llistes ({{ stat['lvigents']|number_format(0, ',', '.') }} llicències)</span></div>
				<div id="partes-import" class="col-listheader total-rowcount">Saldo del club<br><span>(Pendent)</span>{# stat['saldo']|number_format(2, ',', '.') € #}</div>
			</div>
		</div>
	    <div class="table-header">	
		   	<div id="list-header">
		   		<div id="header-parteid" class="col-listheader">{{ knp_pagination_sortable(partes, 'Albarà', 'p.id') }}
		   			<span class="listheader-icon {% if partes.isSorted('p.id') %} listheader-icon-{{ sortparams['direction'] }} {% endif %}"></span></div>
		   		<div id="header-parteany" class="col-listheader">Any<span class="listheader-icon"></span></div>
		   		<div id="header-partedata" class="col-listheader col-listheader-sortable">{{ knp_pagination_sortable(partes, 'Inici', 'p.dataalta') }}
		   			<span class="listheader-icon {% if partes.isSorted('p.dataalta') %} listheader-icon-{{ sortparams['direction'] }} {% endif %}"></span></div>
		   		<div id="header-partetipusdesc" class="col-listheader col-listheader-sortable">{{ knp_pagination_sortable(partes, 'Tipus', 't.id') }}
		   			<span class="listheader-icon {% if partes.isSorted('t.id')  %} listheader-icon-{{ sortparams['direction'] }} {% endif %}"></span></div>
		   		<div id="header-partetotal" class="col-listheader col-listheader-sortable">{{ knp_pagination_sortable(partes, 'Llicències', 'numllicencies', {'direction': 'desc'}) }}
		   			<span class="listheader-icon {% if partes.isSorted('numllicencies') %} listheader-icon-{{ sortparams['direction'] }} {% endif %}"></span></div>
		   		<div id="header-parteimport" class="col-listheader collistheader-noorder">Preu</div>
		   		<div id="header-parteestat" class="col-listheader collistheader-noorder">Informació</div>
		   		<div id="header-parteactions" class="col-listheader collistheader-noorder"> &nbsp;</div>
		   	</div>
	   	</div>
		{% if partes|length > 0 %}
		<div class="table-scroll">
		   	<ol id="list-data">
			{% for parte in partes %}
		   		<li class="data-detall {% if parte.isPassat %} data-detall-fosc {% endif %}">
		   			<div class="data-detall-cell parte-id">{{ parte.numalbara }}</div>
			   		<div class="data-detall-cell parte-any">{{ parte.any }}</div>
			   		<div class="data-detall-cell parte-data"><time datetime="{{ parte.dataalta|date('c') }}">{{ parte.dataalta|date('d/m/Y') }}</time></div>
			   		<div class="data-detall-cell parte-tipusdesc">{{ parte.tipus.descripcio }}</div>
			   		<div class="data-detall-cell parte-total"> 
			   		<a class="llista-llicencies" href="{{ path('FecdasPartesBundle_llicenciesParte', { 'id': parte.id }) }}" title="Llicències">{{ parte.numLlicencies }}
			   		<img src="{{ asset('images/icon-historial.png') }}" alt="Llicències" title="Llicències" width="23px"></a>
			   		</div>
			   		<div class="data-detall-cell parte-import">{{ parte.getPreuTotalIVA|number_format(2, ',', '.') }} €</div>
			   		<div class="data-detall-cell parte-estat">{{ parte.getInfoLlistat }}</div>
		   			<div class="data-detall-cell parte-actions">
		   				{% if parte.allowRenovar and parte.numLlicencies > 0 %}
		   				<a class="parte-action-renew" href="{{ path('FecdasPartesBundle_renovar', { 'id': parte.id }) }}"><img src="{{ asset('images/icon-renovar.png') }}" alt="Renovar" title="Renovar" width="23px"></a>
		   				{% endif %}
		   				<a class="parte-action-view" href="{{ path('FecdasPartesBundle_parte', { 'id': parte.id, 'action':'view' }) }}"><img src="{{ asset('images/icon-view.png') }}" alt="Editar Veure" title="Editar Veure" width="23px"></a>
		   			</div>
		   		</li>
		   		{% endfor %}
			</ol>
		</div>
		{% if partes.getTotalItemCount > 10 %}<div class="navigation">Pàgines: {{ knp_pagination_render(partes, null, sortparams) }}</div>{% endif %}
	   	{% else %}
	    <div class="sms-notice">No hi ha llistats d'assegurats per aquest club</div>
	    {% endif %}
	</div>
    <div class="sms-footer">Per esborrar alguna llista cal posar-se en contacte amb la Federació</div>
    <div id="historial-llicencies" class="finestra-overlay"></div>
{% endblock %}

{% block javascripts %}

{{ parent() }}

<script type="text/javascript">

$(document).ready(function(){
	setMenuActive("menu-partes");
	
	removeParteLink();

	showLlicenciesParte();

	var dataDesde = $( "#form_desde" ).val();
	var dataFins = $( "#form_fins" ).val();
	var tipusParte = $( "#form_tipus" ).val();
	
	loadCalendar($( "#form_desde" ),function (selectedDateTime) {
		// Recarrega consulta afegint la data
		window.location = "{{ path('FecdasPartesBundle_partes', sortparams)|raw }}"+"&desde="+selectedDateTime+"&fins="+dataFins+"&tipus="+tipusParte; 
	});

	loadCalendar($( "#form_fins" ),function (selectedDateTime) {
		// Recarrega consulta afegint la data
		window.location = "{{ path('FecdasPartesBundle_partes', sortparams)|raw }}"+"&desde="+dataDesde+"&fins="+selectedDateTime+"&tipus="+tipusParte; 
	});

	$("#form_tipus").change(function() {
		tipusParte = $( "#form_tipus" ).val();
		window.location = "{{ path('FecdasPartesBundle_partes', sortparams)|raw }}"+"&desde="+dataDesde+"&fins="+dataFins+"&tipus="+tipusParte; 
    });
	
	//sortLlista("col-listheader", "list-data");

	var tableScroll = $('.table-scroll');
	if (tableScroll.hasOverflowY()) {
		$('.table-scroll').css({"width":"101.5%"});
	}
});

</script>


{% endblock %}

