{# src/Fecdas/PartesBundle/Resources/views/Page/parte.html.twig #}
{% extends 'FecdasPartesBundle::layout.html.twig' %}

{% block javascriptshead %}
 	{{ parent() }}
   	<script src="{{ asset('js/jquery.ui.datepicker-ca.js') }}" type="text/javascript"></script>
   	<script src="{{ asset('js/jquery-ui-timepicker-addon.js') }}" type="text/javascript"></script>
   	<script src="{{ asset('js/jquery-ui-timepicker-ca.js') }}" type="text/javascript"></script>
   	 {{ form_javascript(form) }}
{% endblock %}

{% block title %}Aplicació gestió FECDAS. Gestió de llistes d'assegurats{% endblock %}

{% block body %}
    <header>
        <h1>Gestió de llistes d'assegurats</h1>
    </header>
   
	<form id="formparte" action="{{ path('FecdasPartesBundle_parte') }}" method="post" {{ form_enctype(form) }}  class="appform">
		{%  if form_errors(form) is not empty %}
			<div class="sms-notice">{{ form_errors(form)  }}</div>
		{% endif %}	
		
		<div id="formparte-id">
			{{ form_widget(form.id) }}
		</div>
		<div class="sms-header-info">{{ parte.infoParte }}</div> 
		<div class="form-row clearfix">
			<div id="formparte-any" class="form-left">
				<label class="formlabel-outside required">Any</label>
				{{ form_widget(form.any, { 'attr': {'class': 'formfield-outside'} }) }}
			</div>
			<div id="formparte-dataalta" class="form-left">
				<label class="formlabel-outside required">Validesa des de</label>
				{{ form_widget(form.dataalta, { 'attr': {'class': 'formfield-outside formtime-calendar'} }) }}
			</div>
			<div id="formparte-tipus" class="form-left" data-ajax-route="{{ path('FecdasPartesBundle_gettipuspartes') }}">
				{{ form_label(form.tipus, 'Tipus de llistat d\'assegurats', { 'label_attr': {'class': 'formlabel-outside'} }) }}
				{{ form_widget(form.tipus, { 'attr': {'class': 'formfield-outside'} }) }}
				<img width="21px" id="help-tipusparte" src="{{ asset('images/icon-query.png') }}" style="cursor: pointer;">
			</div>
			<div id="formparte-novallicencia" class="form-left">
				<div class="textaccio">
					<a  onclick="loadLlicencia.call(this, 0)" href="javascript:void(0);" id="displayText">Afegir llicència<img src="/images/icon_dropdown.png"></a></div>
				</div>
			<div id="formparte-datapagament" class="form-left" {% if parte.datapagament is null %} style="display: none" {% endif %}>
				<label class="formlabel-outside required">Data Pagament</label>
				{{ form_widget(form.datapagament, { 'attr': {'class': 'formfield-outside formdate-calendar'} }) }}
			</div>
			{% if admin == true and parte.datapagament is null %}
				{% if parte.id is not null %}
				<div id="formparte-pagamentconfirm" class="form-left">
					<div class="textaccio">
						<a id="formparte-button-pagat" href="{{ path('FecdasPartesBundle_confirmapagament', { 'id': parte.id }) }}">
						Pagament Rebut<img src="/images/icon-euro.png"></a>
					</div>
				</div>
				{% endif %}
			{% endif %}
			<div class="buttons-top" {% if ((parte.id is null) or (parte.numLlicencies == 0))  %} style="display:none" {% endif %}>
				{% if not parte.pagat and (parte.pendent or parte.pendentSincronitzar)  %}
				<!-- No Pagat -->
	        	<div id="parte-pagament" class="button-top">	
	        		<a id="formparte-payment" href="{{ path('FecdasPartesBundle_pagament', { 'id': parte.id}) }}">
						<img src="{{ asset('images/icon-creditcard.png') }}" alt="Pagament" title="Pagament" width="40px"></a>
				</div>
				{% endif %}	
				<div id="parte-to-pdf" class="button-top">
					<a href="{{ path('FecdasPartesBundle_partetopdf', { 'id': parte.id}) }}">
						<img src="{{ asset('images/icon-pdf.png') }}" alt="llista llicències" title="llista llicències" width="40px"></a></div>
					<!-- només factures amb número factura del web -->
				{% if parte.numfactura is not null %} 
					<div id="factura-to-pdf" class="button-top">
						<a href="{{ path('FecdasPartesBundle_facturatopdf', { 'id': parte.id}) }}">
						<img src="{{ asset('images/icon-factura.png') }}" alt="Factura" title="Factura" width="40px"></a>
					</div>
				{% else %}
					<div id="albara-to-pdf" class="button-top">
						<a href="{{ path('FecdasPartesBundle_albaratopdf', { 'id': parte.id}) }}">
						<img src="{{ asset('images/icon-albara.jpg') }}" alt="Albarà" title="Albarà" width="35px"></a>
					</div>
				{% endif %}
			</div>	
		</div>
         
		<div id="formparte-rest">	{{ form_rest(form) }}</div>
		
		<div id="error" class="sms-notice" style="display:none"> </div>
    </form>

    <div id="progressbar" style="display:none"><img src="/images/icon_progress.gif"></div>
    <div id="edicio-llicencies" >
	    <form id="formllicencia" action="{{ path('FecdasPartesBundle_llicencia') }}" method="post" {{ form_enctype(form) }}  class="appform">
			<div id="formparte-llicencia" class="parte-llicencia" style="display: none"></div>
			{#  include "FecdasPartesBundle:Page:partellicencia.html.twig" #}
		</form>	
	</div>
    
	<div id="llista-llicencies" class="maxwidth-bloc">
	{% include "FecdasPartesBundle:Page:partellistallicencies.html.twig" %}
	</div> 
	<div class="sms-footer">Per esborrar alguna llicència cal posar-se en contacte amb la Federació</div>
	
    <div id="edicio-persona" class="finestra-overlay"></div>
     
{% endblock %}

{% block javascripts %}

{{ parent() }}

<script type="text/javascript">

$(document).ready(function(){
	setMenuActive("menu-partes");

	{% if (parte.id is null) %}
		loadTimeCalendar($( "#parte_dataalta" ),	
				new Date({{ datesparte['min']['any'] }}, {{ datesparte['min']['mes'] }} - 1, {{ datesparte['min']['dia'] }}), 
				new Date({{ datesparte['max']['any'] }}, {{ datesparte['max']['mes'] }} - 1, {{ datesparte['max']['dia'] }}),
				function (selectedDateTime) {
					reloadParteData(selectedDateTime);
				}); 

	{% endif %} 

	{% if parte.allowedit == true %}
		reloadParteTipus();
	{% endif %} 
	
	removeLlicenciaClick();

	confirmarPartePagat();
	
	partePagamentButton();
	
	showResumParteDetall();

	sortLlista("col-listheader", "list-data");

	$('.table-scroll').each(function() {
		if ($(this).hasOverflowY()) {
			$(this).css({"width":"101.5%"});
		}
	});
	
	
	if ($("#parte_tipus option").length == 1) {
	/* Només si hi ha disponible més d'una llicència */
		$("#help-tipusparte").hide();
	} else {
		helpBubbles("#help-tipusparte", '<p align="left" style="text-decoration: underline"><b>Llicències federatives habilitades per competir</b></p>\
			<p align="left"><b>A</b>: Llicència federativa anual fins a 31/12.</p>\
			<p align="left"><b>AC</b>: Llicència federativa habilitada per competició temporada, fins 30/09<br/>(Hoquei, Rugby i Natació amb Aletes)</p>\
			<p align="left"><b>AE</b>: Llicència federativa 365 dies a partir de l\'alta.</p>\
			<p align="left"><b>AQ</b>: Llicència federativa Reduïda, darrer Quatrimestre, des del 01/09 fins 31/12. <br/>Habilitada per competició temporada</p>\
			<p align="left" style="text-decoration: underline"><b>Assegurances no habilitades per competir</b></p>\
			<p align="left"><b>B</b>: Assegurança federativa anual fins a 31/12.</p>\
			<p align="left"><b>B 365</b>: Assegurança federativa 365 dies a partir de l\'alta. <br/>\
			Per a bussejadors o instructors que no tenen una titulació FECDAS/CMAS. <br/>\
			No habilitada per competició ni per fer cursos federats.</p>\
			<p align="left"><b>D</b>: Assegurança per un dia.</p>');
	};	
});

</script>


{% endblock %}

