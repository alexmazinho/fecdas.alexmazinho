{# src/Fecdas/PartesBundle/Resources/views/Page/parte.html.twig #}
{% extends 'FecdasPartesBundle::layout.html.twig' %}

{% block javascriptshead %}
 	{{ parent() }}
   	<script src="{{ asset('js/jquery.ui.datepicker-ca.js') }}" type="text/javascript"></script>
   	 {{ form_javascript(form) }}
{% endblock %}

{% block title %}Aplicació gestió FECDAS. Gestió de llistes d'assegurats{% endblock %}

{% block body %}
    <header>
        <h1>Gestió de llistes d'assegurats</h1>
    </header>
   
	<form id="formparte" action="{{ path('FecdasPartesBundle_parte') }}" method="post" {{ form_enctype(form) }}  class="appform">
		{%  if form_errors(form) is not empty %}
			<div class="sms-notice">{{ form_errors(form)  }}</div>
		{% endif %}	
		<div id="buttons-top" {% if ((parte.id is null) or (parte.numLlicencies == 0))  %} style="display:none" {% endif %}>
			<div class="button-top"><a href="{{ path('FecdasPartesBundle_partetopdf', { 'id': parte.id}) }}">
			<img src="{{ asset('images/icon-pdf.png') }}" alt="llista llicències" title="llista llicències" width="30px"></a></div>
			{% if edit == true %}
			<!-- No Pagat -->
        		<div class="button-top">	
					<input type="image" src="{{ asset('images/icon-creditcard.png') }}" alt="Pagament" title="Pagament" width="30px" 
					 id="formparte-button-payment" class="forminput-inside" value="Pagar" name="formparte-button-payment"/>
				</div>
				{# if admin == true %}
				<div id="formparte-delete" class="parte-submit" >	
					<input type="image" src="{{ asset('images/icon-remove.png') }}" alt="Esborrar llista llicències" title="Esborrar llista llicències" width="30px" 
					id="formparte-button-delete" class="forminput-inside" value="Esborrar Llista" name="formparte-button-delete"/>
				</div>
				{% endif #}
			{% else  %}
				<!-- només factures si pagades pel web -->
				{% if parte.numfactura is not null and parte.isFacturaValida == true %}
					{% if parte.numfactura == -1 %}
						<div class="button-top"><img src="{{ asset('images/icon-factura.png') }}" alt="Factura Pendent confirmar pagament" title="Factura Pendent confirmar pagament" width="30px"></div>
					{% else %}
						<div class="button-top"><a href="{{ path('FecdasPartesBundle_facturatopdf', { 'id': parte.id}) }}">
						<img src="{{ asset('images/icon-factura.png') }}" alt="Factura" title="Factura" width="30px"></a></div>
					{% endif %}
				{% endif %}	
			<!-- Pagat -->
			{% endif %}	
		</div>			
		
		<did style="float:right;height: 0;">
			
		</did>
		<div id="formparte-id">
			{{ form_widget(form.id) }}
		</div>
		<div class="form-row clearfix">
			<div id="formparte-any">
				<label class="formlabel-outside required">Any</label>
				{# form_label(form.dataalta, 'Data Alta', { 'attr': {'class': 'formlabel-outside'} }) #}
				{{ form_widget(form.any, { 'attr': {'class': 'formfield-outside'} }) }}
			</div>
			<div id="formparte-club">
				{{ form_label(form.club, 'Club', { 'attr': {'class': 'formlabel-outside'} }) }}
				{{ form_widget(form.club, { 'attr': {'class': 'formfield-outside'} }) }}
			</div>
			<div id="formparte-datapagament" {% if parte.datapagament is null %} style="display: none" {% endif %}>
				<label class="formlabel-outside required">Data Pagament</label>
				{# form_label(form.datapagament, 'Data Facturació', { 'attr': {'class': 'formlabel-outside'} }) #}
				{{ form_widget(form.datapagament, { 'attr': {'class': 'formfield-outside'} }) }}
			</div>
			{% if admin == true and parte.datapagament is null and parte.id is not null %}
				<div id="formparte-submit">
					<label class="formlabel-outside required">&nbsp;</label>
					<input type="submit" id="formparte-button-pagat" value="Pagament Rebut" name="formparte-button-pagat"/>
				</div> 
			{% endif %}
		</div>
		<div class="form-row clearfix">
			{#<div id="formparte-numrelacio">
				{{ form_label(form.numrelacio, 'Relació', { 'attr': {'class': 'formlabel-outside'} }) }}
				{{ form_widget(form.numrelacioshow) }}
				{{ form_widget(form.numrelacio) }}
			</div>#}
			<div id="formparte-dataalta">
				<label class="formlabel-outside required">Validesa des de</label>
				{# form_label(form.dataalta, 'Data Alta', { 'attr': {'class': 'formlabel-outside'} }) #}
				{{ form_widget(form.dataalta, { 'attr': {'class': 'formfield-outside'} }) }}
			</div>
			<div id="formparte-tipus" data-ajax-route="{{ path('FecdasPartesBundle_gettipuspartes') }}">
				{{ form_label(form.tipus, 'Tipus de llistat d\'assegurats', { 'attr': {'class': 'formlabel-outside'} }) }}
				{{ form_widget(form.tipus, { 'attr': {'class': 'formfield-outside'} }) }}
				<img width="20px" id="help-tipusparte" src="{{ asset('images/icon-query.png') }}" style="cursor: pointer;">
			</div>
        </div>
         
        <div class="form-row clearfix">
        	{% if edit == true %}
				<div id="formparte-novallicencia" class="textaccio">
					<a id="displayText" href="javascript:void(0);" onclick="loadLlicencia.call(this, 0)" >
					Nova llicència
					<img src="{{ asset('images/icon_dropdown.png') }}">
					</a>
				</div>
			{% endif %}	
		</div>
		<div id="formparte-rest">	{{ form_rest(form) }}</div>
		
		<div id="error" class="sms-notice" style="display:none"> </div>
    </form>

    <div id="progressbar" style="display:none"><img src="/images/icon_progress.gif"></div>
    <div id="edicio-llicencies" class="maxwidth-bloc">
	    <form id="formllicencia" action="{{ path('FecdasPartesBundle_llicencia') }}" method="post" {{ form_enctype(form) }}  class="appform">
			<div id="formparte-llicencia" class="parte-llicencia" style="display: none"></div>
			{#  include "FecdasPartesBundle:Page:partellicencia.html.twig" #}
		</form>	
	</div>
    
	<div id="llista-llicencies" class="maxwidth-bloc">
	{% include "FecdasPartesBundle:Page:partellistallicencies.html.twig" %}
	</div> 
	<div class="sms-footer">Per esborrar alguna llicència cal posar-se en contacte amb la Federació</div>
	
    <div id="edicio-persona" class="finestra-overlay"></div>
     
{% endblock %}

{% block javascripts %}

{{ parent() }}

<script type="text/javascript">

$(document).ready(function(){
	setMenuActive("menu-partes");
	
	reloadParte();

	removeLlicenciaClick();

	removeParteButton();

	partePagatButton();

	partePagamentButton();
	
	showResumParteDetall();

	if ($("#parte_tipus option").length == 1) {
	/* Només si hi ha disponible més d'una llicència */
		$("#help-tipusparte").hide();
	} else {
		helpBubbles("#help-tipusparte", '<p align="left" style="text-decoration: underline"><b>Llicències federatives habilitades per competir</b></p>\
			<p align="left"><b>A</b>: Llicència federativa anual fins a 31/12.</p>\
			<p align="left"><b>AC</b>: Llicència federativa habilitada per competició temporada, fins 30/09<br/>(Hoquei, Rugby i Natació amb Aletes)</p>\
			<p align="left"><b>AE</b>: Llicència federativa 365 dies a partir de l\'alta.</p>\
			<p align="left"><b>AQ</b>: Llicència federativa Reduïda, darrer Quatrimestre, des del 01/09 fins 31/12. <br/>Habilitada per competició temporada</p>\
			<p align="left" style="text-decoration: underline"><b>Assegurances no habilitades per competir</b></p>\
			<p align="left"><b>B</b>: Assegurança federativa anual fins a 31/12.</p>\
			<p align="left"><b>B 365</b>: Assegurança federativa 365 dies a partir de l\'alta. <br/>\
			Per a bussejadors o instructors que no tenen una titulació FECDAS/CMAS. <br/>\
			No habilitada per competició ni per fer cursos federats.</p>\
			<p align="left"><b>D</b>: Assegurança per un dia.</p>');
	};	
});

</script>


{% endblock %}

