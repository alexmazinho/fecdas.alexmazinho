{# src/Fecdas/productesBundle/Resources/views/Facturacio/productes.html.twig #}
{% extends 'FecdasBundle::layout.html.twig' %}

{% block javascriptshead %}
 	{{ parent() }}
 	<script src="{{ asset('js/jquery.ui.datepicker-ca.js') }}" type="text/javascript"></script>
 	<script src="{{ asset('js/utils/purl.js') }}" type="text/javascript"></script>
    {{ form_javascript(form) }}
{% endblock %}

{% block title %}Aplicació gestió FECDAS. Llista de productes {% endblock %}

{% block body %}
	<header>
        <h1>Llista de productes</h1>
    </header>
    {% for flashMessage in app.session.flashbag.get('error-notice') %}
    <div class="sms-notice">
		{{ flashMessage }}
  	</div>	
	{% endfor %}
        
    <div id="productes-main">
	    <div id="list-forms">
	    	<form id="form_productes" action="{{ path('FecdasBundle_productes') }}" method="POST" {{ form_enctype(form) }}  class="appform">
    			<div id="formproductes-cerca" class="form-col column-left form-left">
	    			{{ form_label(form.cerca, 'Cercar', { 'label_attr': {'class': 'formlabel-outside'} }) }}
					{{ form_widget(form.cerca, { 'attr': {'class': 'formfield-outside'} }) }}
				</div> 
				<div id="formproductes-tipus" class="form-col column-left form-left">
					{{ form_label(form.tipus, 'Tipus de producte', { 'label_attr': {'class': 'formlabel-outside'} }) }}
					{{ form_widget(form.tipus, { 'attr': {'class': 'formfield-outside'} }) }}
				</div>
				<div id="formproductes-baixes" class="productes-check check-correu" class="form-left">
					{{ form_label(form.baixes, 'Mostrar baixes', { 'label_attr': {'class': 'formlabel-lefttocheckbox'} }) }}
					{{ form_widget(form.baixes, { 'attr': {'class': 'formcheckbox-right'} }) }}
				</div>
				<div id="formproductes-submit" class="form-col column-right form-right">	
					<div class="formlabel-outside">&nbsp;</div>
					<input id="formproductes_cercar" type="submit" class="forminput-inside" value="Cerca" name="formproductes-button-search"/>
				</div> 
		   	</form>
	    </div>
	    <div class="table-header">
			<div id="summary-header">
				<div id="productes-totals" class="col-listheader total-rowcount">Total: {{ productes.getTotalItemCount|number_format(0, ',', '.') }}</div>
			</div>
		</div>
	    <div class="table-header">	
		   	<div id="list-header">
				<div id="header-producte-id" class="col-listheader">&nbsp;</div>
		   		<div id="header-producte-codi" class="col-listheader">{{ knp_pagination_sortable(productes, 'Codi', 'p.codi') }}
		   			<span class="listheader-icon {% if productes.isSorted('p.codi') %} listheader-icon-{{ sortparams['direction'] }} {% endif %}"></span></div>
		   		<div id="header-producte-nomcurt" class="col-listheader col-listheader-sortable">{{ knp_pagination_sortable(productes, 'Abr.', 'p.abreviatura') }}
		   			<span class="listheader-icon {% if productes.isSorted('p.abreviatura') %} listheader-icon-{{ sortparams['direction'] }} {% endif %}"></span></div>
		   		<div id="header-producte-descripcio" class="col-listheader col-listheader-sortable">{{ knp_pagination_sortable(productes, 'Descripcio', 'p.descripcio') }}
		   			<span class="listheader-icon {% if productes.isSorted('p.descripcio') %} listheader-icon-{{ sortparams['direction'] }} {% endif %}"></span></div>
		   		<div id="header-producte-tipus" class="col-listheader col-listheader-sortable">{{ knp_pagination_sortable(productes, 'Tipus', 'p.tipus') }}
		   			<span class="listheader-icon {% if productes.isSorted('p.tipus') %} listheader-icon-{{ sortparams['direction'] }} {% endif %}"></span></div>
		   		<div id="header-producte-import" class="col-listheader collistheader-noorder">Preu</div>
		   		<div id="header-producte-iva" class="col-listheader collistheader-noorder">IVA</div>
		   		<div id="header-producte-iva" class="col-listheader collistheader-noorder">Total</div>
		   		<div id="header-producte-minim" class="col-listheader col-listheader-sortable">{{ knp_pagination_sortable(productes, 'Mín. comanda', 'p.minim') }}
		   			<span class="listheader-icon {% if productes.isSorted('p.minim') %} listheader-icon-{{ sortparams['direction'] }} {% endif %}"></span></div>
		   		<div id="header-producte-limit" class="col-listheader col-listheader-sortable">{{ knp_pagination_sortable(productes, 'Notifica per sota', 'p.stockable') }}
		   			<span class="listheader-icon {% if productes.isSorted('p.stockable') %} listheader-icon-{{ sortparams['direction'] }} {% endif %}"></span></div>
		   		<div id="header-producte-stock" class="col-listheader col-listheader-sortable">{{ knp_pagination_sortable(productes, 'En Stock', 'p.stock') }}
		   			<span class="listheader-icon {% if productes.isSorted('p.stock') %} listheader-icon-{{ sortparams['direction'] }} {% endif %}"></span></div>
		   		<div id="header-producte-actions" class="col-listheader collistheader-noorder">&nbsp;</div>
		   	</div>
	   	</div>
		{% if productes|length > 0 %}
		<div class="table-scroll">
		   	<ol id="list-data">
			{% for producte in productes %}
		   		<li class="data-detall {% if producte.esBaixa %} data-detall-fosc {% endif %}">
		   			<div class="data-detall-cell producte-id">{{ producte.id }}</div>
		   			<div class="data-detall-cell producte-codi">{{ producte.codi }}</div>
		   			<div class="data-detall-cell producte-nomcurt">{{ producte.abreviatura }}</div>
		   			<div class="data-detall-cell producte-descripcio">{{ producte.descripcio }}</div>
		   			<div class="data-detall-cell producte-tipus">{{ producte.tipus }}</div>
		   			<div class="data-detall-cell producte-import">{{ producte.currentPreu|number_format(2, ',', '.') }}€</div>
		   			<div class="data-detall-cell producte-iva">{{ (producte.currentIva*100)|number_format(0, ',', '.') }}%</div>
		   			<div class="data-detall-cell producte-import">{{ (producte.currentPreu * (1+producte.currentIva))|number_format(2, ',', '.') }}€</div>
		   			<div class="data-detall-cell producte-minim">{{ producte.minim }}</div>
		   			<div class="data-detall-cell producte-limit">{{ producte.limitnotifica }}</div>
		   			<div class="data-detall-cell producte-stock">{{ producte.stock }}</div>
		   			<div class="data-detall-cell producte-actions">
		   				<a class="producte-action-edit" href="{{ path('FecdasBundle_editarproducte', { 'id': producte.id }) }}"><img src="{{ asset('images/icon-view.png') }}" alt="Editar" title="Editar" width="23px"></a>			
						{% if not producte.esBaixa %}
		   				<a class="producte-action-baixa" href="{{ path('FecdasBundle_baixaproducte', { 'id': producte.id }) }}"><img src="{{ asset('images/icon-renovar.png') }}" alt="Baixa" title="Baixa" width="23px"></a>
		   				{% endif %}
		   			</div>
		   		</li>
		   		{% endfor %}
			</ol>
		</div>
		{% if productes.getTotalItemCount > 10 %}<div class="navigation">Pàgines: {{ knp_pagination_render(productes, null, sortparams) }}</div>{% endif %}
	   	{% else %}
	    <div class="sms-notice">No hi ha productes per mostrar</div>
	    {% endif %}
	</div>
    <div id="dialeg-edicio-producte" class="finestra-overlay"></div>
{% endblock %}

{% block javascripts %}

{{ parent() }}

<script type="text/javascript">

$(document).ready(function(){
	setMenuActive("menu-productes");
	
	removeproducteLink();

	showLlicenciesproducte();

	var dataDesde = $( "#form_desde" ).val();
	var dataFins = $( "#form_fins" ).val();
	var tipusproducte = $( "#form_tipus" ).val();
	
	loadCalendar($( "#form_desde" ),function (selectedDateTime) {
		// Recarrega consulta afegint la data
		window.location = "{{ path('FecdasBundle_productes', sortparams)|raw }}"+"&desde="+selectedDateTime+"&fins="+dataFins+"&tipus="+tipusproducte; 
	});

	loadCalendar($( "#form_fins" ),function (selectedDateTime) {
		// Recarrega consulta afegint la data
		window.location = "{{ path('FecdasBundle_productes', sortparams)|raw }}"+"&desde="+dataDesde+"&fins="+selectedDateTime+"&tipus="+tipusproducte; 
	});

	$("#form_tipus").change(function() {
		tipusproducte = $( "#form_tipus" ).val();
		window.location = "{{ path('FecdasBundle_productes', sortparams)|raw }}"+"&desde="+dataDesde+"&fins="+dataFins+"&tipus="+tipusproducte; 
    });
	
	//sortLlista("col-listheader", "list-data");

	var tableScroll = $('.table-scroll');
	if (tableScroll.hasOverflowY()) {
		$('.table-scroll').css({"width":"101.5%"});
	}
});

</script>


{% endblock %}

